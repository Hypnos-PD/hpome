<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HypnosPD</title>
    <style>
        :root {
            --background-color: #fdfdfd;
            --text-color: #333;
            --motto-font-size: 3rem;
            --terminal-background: #0f0f12;
            --terminal-text: #d4d4d4;
            --terminal-accent: #0aa0ff;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            text-align: center;
        }

        .motto {
            font-size: var(--motto-font-size);
            font-weight: bold;
            margin: 2rem 0;
            letter-spacing: 2px;
        }

        .avatar {
            width: 300px;
            height: 300px;
            aspect-ratio: 1 / 1;
            margin-bottom: 2rem;
            background-image: url('https://avatars.githubusercontent.com/u/177898240');
            background-size: cover;
            background-position: center;
            border: 2px solid var(--text-color);
        }

        .terminal {
            width: 80%;
            max-width: 800px;
            height: 420px;
            background-color: var(--terminal-background);
            color: var(--terminal-text);
            position: relative;
            overflow: hidden;
            padding: 1rem;
            box-sizing: border-box;
            overflow-y: auto;
            text-align: left;
            border: none;
            font-family: 'VT323', 'Noto Serif SC', 'Noto Sans SC', 'Menlo', 'Monaco', 'Courier New', monospace;
            font-size: 30px;
            background: rgba(8, 10, 12, 0.92);
            border: 1px solid rgba(255, 255, 255, 0.04);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6), 0 0 40px rgba(10, 160, 255, 0.06) inset;
            padding: 1.25rem;
        }

        .terminal-output {
            white-space: pre-wrap;
        }

        .terminal-input-line {
            display: flex;
        }

        .terminal-prompt {
            margin-right: 0.5rem;
            color: var(--terminal-accent);
        }

        .terminal-input {
            background: transparent;
            border: none;
            color: var(--terminal-text);
            caret-color: var(--terminal-accent);
            font-family: inherit;
            font-size: inherit;
            width: 100%;
            outline: none;
        }

        .terminal, .terminal-output, .terminal-output .line, .terminal-output .line .plain {
            user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }

        .terminal::before {
            content: "";
            position: absolute;
            inset: 0;
            pointer-events: none;
            background-image: linear-gradient(rgba(0, 0, 0, 0.25) 0%, rgba(0, 0, 0, 0.25) 50%, transparent 50%);
            background-size: 100% 3px;
            mix-blend-mode: multiply;
            opacity: 0.45;
        }

        .terminal::after {
            content: "";
            position: absolute;
            inset: 0;
            pointer-events: none;
            background-image: radial-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px);
            background-size: 4px 4px;
            mix-blend-mode: overlay;
            opacity: 0.2;
        }

        .terminal-output {
            white-space: pre-wrap;
            color: var(--terminal-text);
            position: relative;
            font-size: 28px;
            line-height: 1.45;
        }

        .terminal-output .line {
            display: block;
            position: relative;
            padding-right: 0.25rem;
            overflow: hidden;
        }

        .terminal-output .line .glow{
            position: absolute;
            left: 0;
            top: 0;
            right: 0;
            display: block;
            width: 100%;
            box-sizing: border-box;
            color: var(--terminal-accent);
            filter: blur(4px) saturate(1.6);
            opacity: 0.85;
            z-index: 0;
            pointer-events: none;
            mix-blend-mode: screen;
            transform-origin: left center;
            animation: neonPulse 4.5s ease-in-out infinite;
            white-space: pre-wrap;
        }

        .terminal-output .line .plain {
            position: relative;
            z-index: 1;
        }

        @keyframes neonPulse {
            0% {
                filter: blur(3px) saturate(1.2);
                opacity: 0.7;
                transform: translateY(0px) scale(1);
            }

            50% {
                filter: blur(8px) saturate(1.8);
                opacity: 1;
                transform: translateY(-0.6px) scale(1.01);
            }

            100% {
                filter: blur(3px) saturate(1.2);
                opacity: 0.75;
                transform: translateY(0px) scale(1);
            }
        }

        .terminal-output span,
        .terminal-output,
        .terminal-input {
            text-shadow: 0 0 6px rgba(10, 160, 255, 0.25), 0 1px 0 rgba(0, 0, 0, 0.6);
        }

        .terminal-prompt {
            color: var(--terminal-accent-bright, #7ce0ff);
            text-shadow: 0 0 10px rgba(124, 224, 255, 0.9), 0 1px 0 rgba(0, 0, 0, 0.6);
        }

        footer {
            padding: 2rem;
            text-align: center;
        }

        .social-icons a {
            color: var(--text-color);
            margin: 0 1rem;
            text-decoration: none;
            font-size: 1.5rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            height: 24px;
            line-height: 1;
        }

        .social-icons i {
            font-size: 1.5rem;
            color: inherit;
            display: block;
            width: 24px;
            height: 24px;
        }

        .social-icons svg {
            width: 24px;
            height: 24px;
            display: block;
        }

        .suggestions {
            position: absolute;
            left: 1.25rem;
            right: 1.25rem;
            bottom: 3.25rem;
            max-height: 160px;
            overflow: auto;
            background: rgba(6, 8, 10, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.04);
            color: var(--terminal-text);
            font-family: inherit;
            font-size: 18px;
            padding: 6px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
            z-index: 40;
            display: none;
            gap: 6px;
            border-radius: 4px;
        }

        .suggestions .item {
            padding: 4px 8px;
            cursor: pointer;
            border-radius: 3px;
        }

        .suggestions .item:hover,
        .suggestions .item.active {
            background: rgba(10, 160, 255, 0.08);
            color: var(--terminal-accent);
        }

        * {
            border-radius: 0 !important;
        }
    </style>
    <!-- 引入开源图标库 Boxicons -->
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <!-- 引入更窄的像素/终端字体 VT323（Latin）、思源宋体 (Noto Serif SC) 作为中文终端字体回退，以及 Noto Sans SC 备选 -->
    <link
        href="https://fonts.googleapis.com/css2?family=VT323&family=Noto+Serif+SC:wght@400;700&family=Noto+Sans+SC:wght@400;700&display=swap"
        rel="stylesheet">
    <!-- favicon 使用 GitHub avatar -->
    <link rel="icon" href="https://avatars.githubusercontent.com/u/177898240" />

    <!-- CRT / VCT 风格 SVG 滤镜：结合模糊、色差与噪点发光以实现霓虹模糊感 -->
    <svg width="0" height="0" style="position:absolute;">
        <defs>
            <filter id="crtFilter" x="-20%" y="-20%" width="140%" height="140%" primitiveUnits="objectBoundingBox">
                <!-- 1) 基础模糊（整体轻微模糊，营造光晕），会动态变化 -->
                <feGaussianBlur in="SourceGraphic" stdDeviation="0.6" result="blurred" id="baseBlur" />
                <animate xlink:href="#baseBlur" attributeName="stdDeviation" values="0.3;1.1;0.4" dur="6s"
                    repeatCount="indefinite" />

                <!-- 2) 色差：分别偏移 R/G/B 通道并合成 -->
                <feColorMatrix in="SourceGraphic" type="matrix" values="1 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 0 1 0"
                    result="rOnly" />
                <feOffset in="rOnly" dx="-0.6" dy="0" result="rOffset" />
                <feColorMatrix in="SourceGraphic" type="matrix" values="0 0 0 0 0  0 1 0 0 0  0 0 0 0 0  0 0 0 1 0"
                    result="gOnly" />
                <feOffset in="gOnly" dx="0.2" dy="0" result="gOffset" />
                <feColorMatrix in="SourceGraphic" type="matrix" values="0 0 0 0 0  0 0 0 0 0  0 0 1 0 0  0 0 0 1 0"
                    result="bOnly" />
                <feOffset in="bOnly" dx="0.6" dy="0" result="bOffset" />

                <!-- 3) 合并色差与模糊层，制造霓虹光晕 -->
                <feBlend in="rOffset" in2="gOffset" mode="screen" result="rg" />
                <feBlend in="rg" in2="bOffset" mode="screen" result="rgbAber" />
                <feGaussianBlur in="rgbAber" stdDeviation="2" result="glow" id="glowBlur" />
                <animate xlink:href="#glowBlur" attributeName="stdDeviation" values="1.2;3.6;1.2" dur="5.5s"
                    repeatCount="indefinite" />

                <!-- 4) 混合 glow 与 原始模糊输出，保留清晰度同时有光晕 -->
                <feBlend in="blurred" in2="glow" mode="screen" result="blurGlow" />

                <!-- 5) 轻微噪点（使用 feTurbulence 但低强度）增强质感 -->
                <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="1" stitchTiles="stitch" result="noise"
                    id="noiseTurb" />
                <animate xlink:href="#noiseTurb" attributeName="baseFrequency" values="0.6;1.2;0.6" dur="7s"
                    repeatCount="indefinite" />
                <feColorMatrix in="noise" type="saturate" values="0" result="noiseMono" />
                <feComponentTransfer in="noiseMono" result="noiseAlpha">
                    <feFuncA type="table" tableValues="0 0.06" />
                </feComponentTransfer>
                <feComposite in="noiseAlpha" in2="blurGlow" operator="in" result="glowWithNoise" />

                <!-- 6) 最终合成：将 glowWithNoise 与 原始 SourceGraphic 混合，保留对比 -->
                <feBlend in="SourceGraphic" in2="glowWithNoise" mode="screen" result="final" />
                <feComposite in="final" in2="SourceGraphic" operator="over" />
            </filter>
        </defs>
    </svg>
</head>

<body>

    <div class="container">
        <h1 class="motto">沈酣世味，混如酒蠁寻酸。</h1>
        <div class="avatar"></div>
        <div class="terminal" id="terminal">
            <div class="terminal-output" id="terminal-output"><span class="line" data-text="欢迎。输入 'help' 获取可用命令列表。你也可以在这里运行简单的 JavaScript 语句。"><span class="plain">欢迎。输入 'help' 获取可用命令列表。你也可以在这里运行简单的 JavaScript 语句。</span></span></div>
            <div class="terminal-input-line">
                <span class="terminal-prompt">&gt;</span>
                <input type="text" class="terminal-input" id="terminal-input" autofocus>
            </div>
        </div>
    </div>

    <footer>
        <div class="social-icons">
            <a href="https://github.com/Hypnos-PD" target="_blank" rel="noopener noreferrer" title="GitHub"
                aria-label="GitHub">
                <i class="bx bxl-github" aria-hidden="true"></i>
            </a>
            <a href="https://qm.qq.com/q/Ad4Le8wLFm" target="_blank" rel="noopener noreferrer" title="QQ"
                aria-label="QQ">
                <svg t="1763345059954" class="icon" viewBox="0 0 1024 1024" version="1.1"
                    xmlns="http://www.w3.org/2000/svg" p-id="1542" width="24" height="24" aria-hidden="true"
                    focusable="false">
                    <path fill="currentColor"
                        d="M824.8 613.2c-16-51.4-34.4-94.6-62.7-165.3C766.5 262.2 689.3 112 511.5 112 331.7 112 256.2 265.2 261 447.9c-28.4 70.8-46.7 113.7-62.7 165.3-34 109.5-23 154.8-14.6 155.8 18 2.2 70.1-82.4 70.1-82.4 0 49 25.2 112.9 79.8 159-26.4 8.1-85.7 29.9-71.6 53.8 11.4 19.3 196.2 12.3 249.5 6.3 53.3 6 238.1 13 249.5-6.3 14.1-23.8-45.3-45.7-71.6-53.8 54.6-46.2 79.8-110.1 79.8-159 0 0 52.1 84.6 70.1 82.4 8.5-1.1 19.5-46.4-14.5-155.8z"
                        p-id="1543"></path>
                </svg>
            </a>
            <a href="https://steamcommunity.com/id/hypnospd" target="_blank" rel="noopener noreferrer" title="Steam"
                aria-label="Steam">
                <i class="bx bxl-steam" aria-hidden="true"></i>
            </a>
        </div>
    </footer>

    <script>
        const terminalOutput = document.getElementById('terminal-output');
        const terminalInput = document.getElementById('terminal-input');
        const pageStart = Date.now();

        function escapeHtml(s) { return String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;'); }
        function cleanWhitespaceNodes(el){
            const nodes = Array.from(el.childNodes);
            for(const n of nodes){
                if(n.nodeType === Node.TEXT_NODE && /^\s*$/.test(n.nodeValue)) n.remove();
            }
        }
        cleanWhitespaceNodes(terminalOutput);
        function appendLine(text) {
            cleanWhitespaceNodes(terminalOutput);
            const span = document.createElement('span');
            span.className = 'line';
            span.setAttribute('data-text', text);
            const glow = document.createElement('span');
            glow.className = 'glow';
            glow.textContent = text;
            const inner = document.createElement('span');
            inner.className = 'plain';
            inner.textContent = text;
            span.appendChild(glow);
            span.appendChild(inner);
            terminalOutput.appendChild(span);
        }

        function formatForTerminal(v) {
            try { return typeof v === 'string' ? v : JSON.stringify(v, null, 2); } catch (e) { return String(v); }
        }
        async function executeJS(code) {
            const origLog = console.log, origInfo = console.info, origWarn = console.warn, origError = console.error, origDir = console.dir;
            function capture(type, args) {
                try { const txt = args.map(a => formatForTerminal(a)).join(' '); appendLine(`[console.${type}] ${txt}`); } catch (e) { appendLine(`[console.${type}] (unprintable)`); }
            }
            console.log = function (...args) { capture('log', args); try { origLog.apply(console, args); } catch (e) { } };
            console.info = function (...args) { capture('info', args); try { origInfo.apply(console, args); } catch (e) { } };
            console.warn = function (...args) { capture('warn', args); try { origWarn.apply(console, args); } catch (e) { } };
            console.error = function (...args) { capture('error', args); try { origError.apply(console, args); } catch (e) { } };
            console.dir = function (...args) { capture('dir', args); try { origDir.apply(console, args); } catch (e) { } };

            try {
                let transformed = code.replace(/^\s*(?:let|const)\s+([A-Za-z_$][\w$]*)\s*=\s*/m, 'window.$1 = ');

                let result;
                try {
                    result = (0, eval)(transformed);
                    if (result instanceof Promise) result = await result;
                } catch (e) {
                    if (e instanceof SyntaxError && /\bawait\b/.test(code)) {
                        const fn = new Function('return (async function(){\n' + code + '\n})();');
                        result = await fn();
                    } else {
                        throw e;
                    }
                }

                if (typeof result !== 'undefined') appendLine(formatForTerminal(result));
            } catch (e) {
                appendLine('JS Error: ' + (e && e.stack ? e.stack : String(e)));
            }

            try { console.log = origLog; console.info = origInfo; console.warn = origWarn; console.error = origError; console.dir = origDir; } catch (e) { }
        }

        const commands = {
            'help': '可用的命令: \n' +
                '  help - 显示所有可用命令\n' +
                '  about - 关于我\n' +
                '  contact - 联系方式\n' +
                '  clear / cls - 清除终端\n' +
                '  date - 显示当前时间\n' +
                '  echo <text> - 回显文本\n' +
                '  uptime - 页面运行时间\n' +
                '  link [name] - 导航到我的其它网站，或不带参数列出可用站点',
            'about': '你好，我是HypnosPD，目前本科在读\n' +
                '有言即达，百无禁忌。',
            'contact': '你可以通过以下方式联系我:\n' +
                '  Email: [hypnospd@qq.com]\n' +
                '  也可以通过页脚的社交媒体图标找到我。',
            'link': '打开我的其它网站: 使用 link <name> 打开对应站点',
            'clear': '清除终端（别名: cls）',
            'cls': '清除终端（别名: clear）',
            'date': '显示当前日期和时间',
            'echo': '回显参数：echo <text>',
            'uptime': '显示页面已运行的秒数',
            'randbg': '随机更改页面背景颜色：randbg 或 randbg <hex|rgb(...)|cssColorName>',
            'set': '在全局范围设置变量：set <name> <js-expr> （等价于 window[name]=expr）',
            'get': '读取全局变量：get <name>'
        };

        const links = {
            'WordleMathSolver': 'https://wdmt.hypd.asia',
            'AzothPath': 'https://azoth.ttopoo.com'
        };

        const linksNormalized = {};
        const linksOriginalName = {};
        Object.keys(links).forEach(k => { linksNormalized[k.toLowerCase()] = links[k]; linksOriginalName[k.toLowerCase()] = k; });

        let completionMatches = [];
        let completionIndex = -1;
        let completionPrefix = '';

        const suggestionsEl = document.createElement('div');
        suggestionsEl.id = 'suggestions';
        suggestionsEl.className = 'suggestions';
        document.getElementById('terminal').appendChild(suggestionsEl);

        function showSuggestions(matches, highlightIndex = 0) {
            suggestionsEl.innerHTML = '';
            if (!matches || matches.length === 0) {
                suggestionsEl.style.display = 'none';
                return;
            }
            matches.slice(0, 50).forEach((m, i) => {
                const it = document.createElement('div');
                it.className = 'item' + (i === highlightIndex ? ' active' : '');
                it.textContent = (linksOriginalName[m] || m);
                it.tabIndex = 0;
                it.addEventListener('click', () => {
                    applyCompletion(m);
                    terminalInput.focus();
                });
                suggestionsEl.appendChild(it);
            });
            suggestionsEl.style.display = 'block';
        }

        function hideSuggestions() {
            suggestionsEl.style.display = 'none';
        }

        function applyCompletion(choice) {
            const val = terminalInput.value;
            const parts = val.split(/\s+/);
            if (parts.length <= 1 || (parts.length > 0 && parts[0].toLowerCase() !== 'link')) {
                terminalInput.value = choice + (choice.indexOf(' ') >= 0 ? '' : ' ');
            } else {
                parts[1] = (linksOriginalName[choice] || choice);
                terminalInput.value = parts.slice(0, 2).join(' ') + ' ';
            }
            completionMatches = [];
            completionIndex = -1;
            completionPrefix = '';
            hideSuggestions();
        }

        function computeMatches(raw) {
            const inputRaw = (typeof raw === 'string') ? raw : (terminalInput.value || '');
            const endsWithSpace = /\s$/.test(inputRaw);
            const parts = inputRaw.trim().split(/\s+/).filter(p => p.length > 0);

            if (parts.length === 0) {
                return [];
            }

            const first = parts[0].toLowerCase();
            if (first === 'link') {
                const secondPrefix = (parts[1] || '');
                const keys = Object.keys(linksNormalized);
                if (secondPrefix === '' && !endsWithSpace) {
                    return ['link'];
                }
                const pref = secondPrefix.toLowerCase();
                return keys.filter(k => k.startsWith(pref));
            }

            const prefix = first;
            const cmds = Object.keys(commands).map(k => k.toLowerCase());
            return cmds.filter(k => k.startsWith(prefix));
        }

        terminalInput.addEventListener('keydown', async function (event) {
            if (event.key === 'Enter') {
                const command = terminalInput.value.trim();
                if (!command) return; 

                appendLine('> ' + command);

                const lc = command.toLowerCase();
                if (lc === 'clear' || lc === 'cls') {
                    terminalOutput.innerHTML = '';
                } else if (lc === 'date') {
                    appendLine(new Date().toString());
                } else if (lc.startsWith('echo ')) {
                    appendLine(command.slice(5));
                } else if (lc === 'uptime') {
                    const s = Math.floor((Date.now() - pageStart) / 1000);
                    appendLine(`页面已运行: ${s} 秒`);
                } else if (lc === 'randbg' || lc.startsWith('randbg ')) {
                    const parts = command.split(/\s+/);
                    let col = parts[1];
                    if (!col) {
                        const h = Math.floor(Math.random() * 360);
                        const s = 60 + Math.floor(Math.random() * 30);
                        const l = 45 + Math.floor(Math.random() * 15);
                        col = `hsl(${h} ${s}% ${l}%)`;
                    }
                    try {
                        document.body.style.backgroundColor = col;
                        appendLine(`已将页面背景色设为: ${col}`);
                    } catch (e) {
                        appendLine(`无法设置颜色: ${col}`);
                    }
                } else if (lc.startsWith('set ')) {
                    const parts = command.split(/\s+/);
                    if (parts.length < 3) { appendLine('用法：set <name> <js-expr>'); }
                    else {
                        const name = parts[1];
                        const expr = command.slice(command.indexOf(name) + name.length + 1);
                        try {
                            const val = (0, eval)(expr);
                            window[name] = val;
                            appendLine(`已设置全局 ${name}`);
                        } catch (e) { appendLine('设置失败: ' + e); }
                    }
                } else if (lc.startsWith('get ')) {
                    const parts = command.split(/\s+/);
                    if (parts.length !== 2) { appendLine('用法：get <name>'); }
                    else {
                        const name = parts[1];
                        try { appendLine(String(window[name])); } catch (e) { appendLine('读取失败'); }
                    }
                } else if (lc.startsWith('link')) {
                    const parts = command.split(/\s+/);
                    if (parts.length === 1) {
                        appendLine('可用链接: ' + Object.keys(links).join(', '));
                        appendLine('使用：link <name> 打开对应站点');
                    } else {
                        const name = parts[1].toLowerCase();
                        if (linksNormalized[name]) {
                            appendLine(`正在打开: ${linksNormalized[name]}`);
                            try { window.open(linksNormalized[name], '_blank', 'noopener'); } catch (e) { /* ignore */ }
                        } else {
                            appendLine(`未知链接名: ${name}`);
                        }
                    }
                } else if (commands[command]) {
                    appendLine(commands[command]);
                } else if (commands[lc]) {
                    appendLine(commands[lc]);
                } else {
                    try {
                        await executeJS(command);
                    } catch (e) {
                        appendLine(`执行 JS 时出错: ${e}`);
                    }
                }

                terminalInput.value = '';
                document.getElementById('terminal').scrollTop = document.getElementById('terminal').scrollHeight;
            }
            else if (event.key === 'Tab') {
                event.preventDefault();
                const val = terminalInput.value;
                let matches = computeMatches(val);
                if ((val || '').trim() === '') {
                    matches = Object.keys(commands).map(k => k.toLowerCase());
                }
                if (matches.length === 0) return;
                const parts = (val.trim().split(/\s+/));
                const prefix = (parts.length >= 2 && parts[0].toLowerCase() === 'link') ? (parts[1].toLowerCase()) : (parts[0].toLowerCase());
                if (prefix !== completionPrefix) {
                    completionPrefix = prefix;
                    completionMatches = matches;
                    completionIndex = 0;
                } else {
                    completionIndex = (completionIndex + 1) % Math.max(1, matches.length);
                }
                const choice = completionMatches[completionIndex];
                if (choice) applyCompletion(choice);
                hideSuggestions();
            }
            else if (event.key === 'ArrowDown' || event.key === 'ArrowUp') {
                if (completionMatches.length === 0) {
                    return;
                }
                event.preventDefault();
                if (completionIndex === -1) completionIndex = 0;
                if (event.key === 'ArrowDown') completionIndex = (completionIndex + 1) % completionMatches.length;
                else completionIndex = (completionIndex - 1 + completionMatches.length) % completionMatches.length;
                const choice = completionMatches[completionIndex];
                if (choice) applyCompletion(choice);
                hideSuggestions();
            }
            else if (event.key === 'Escape') {
                hideSuggestions();
            }
        });

        function insertAtCursor(text){
            try{
                const el = terminalInput;
                const start = el.selectionStart || 0;
                const end = el.selectionEnd || 0;
                el.value = el.value.slice(0,start) + text + el.value.slice(end);
                const pos = start + (text ? text.length : 0);
                el.setSelectionRange(pos,pos);
                el.focus();
            }catch(e){}
        }

        document.addEventListener('contextmenu', function(e){ e.preventDefault(); });

        document.getElementById('terminal').addEventListener('contextmenu', async function(e){
            e.preventDefault();
            try{
                const txt = await navigator.clipboard.readText();
                insertAtCursor(txt);
            }catch(e){}
        });

        document.addEventListener('keydown', async function(e){
            if((e.ctrlKey || e.metaKey) && e.key && e.key.toLowerCase() === 'c'){
                e.preventDefault();
                try{
                    const nodes = Array.from(document.querySelectorAll('.terminal-output .line .plain'));
                    const text = nodes.map(n => n.textContent).join('\n');
                    await navigator.clipboard.writeText(text);
                    appendLine('已复制终端内容到剪贴板');
                }catch(e){
                    appendLine('复制失败');
                }
            }
        });
        terminalInput.addEventListener('input', function () {
            completionMatches = computeMatches();
            completionIndex = -1;
            hideSuggestions();
        });

        document.getElementById('terminal').addEventListener('click', function (e) {
            try {
                terminalInput.focus();
                const len = terminalInput.value.length;
                terminalInput.setSelectionRange(len, len);
            } catch (e) {/* ignore */ }
            if (!e.target.closest || !e.target.closest('.suggestions')) {
                hideSuggestions();
            }
        });

        (function setRandomChineseColor() {
            // 一组中国传统古典色（名称注释）——如需替换或扩展可以修改此列表
            const palette = [
                { name: '胭脂', hex: '#c72c48' },
                { name: '石榴红', hex: '#e45e4b' },
                { name: '茜色', hex: '#9b2d30' },
                { name: '檀色', hex: '#a04b3a' },
                { name: '宋青', hex: '#2b6f77' },
                { name: '黛蓝', hex: '#26547c' },
                { name: '松花', hex: '#9db3b8' },
                { name: '月白', hex: '#dfeef4' },
                { name: '藤黄', hex: '#f5c26b' },
                { name: '杏子', hex: '#f4a261' }
            ];

            const pick = palette[Math.floor(Math.random() * palette.length)];
            document.body.style.backgroundColor = pick.hex; 

            function hexToLuma(hex) {
                const c = hex.replace('#', '');
                const r = parseInt(c.substring(0, 2), 16) / 255;
                const g = parseInt(c.substring(2, 4), 16) / 255;
                const b = parseInt(c.substring(4, 6), 16) / 255;
                const lum = 0.2126 * r + 0.7152 * g + 0.0722 * b;
                return lum;
            }

            const lum = hexToLuma(pick.hex);
            const textColor = lum > 0.6 ? '#222' : '#eef6ff';
            document.documentElement.style.setProperty('--text-color', textColor);

            function hexToHsl(hex) {
                const c = hex.replace('#', '');
                let r = parseInt(c.substring(0, 2), 16) / 255;
                let g = parseInt(c.substring(2, 4), 16) / 255;
                let b = parseInt(c.substring(4, 6), 16) / 255;
                const max = Math.max(r, g, b), min = Math.min(r, g, b);
                let h, s, l = (max + min) / 2;
                if (max === min) { h = s = 0; }
                else {
                    const d = max - min;
                    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                    switch (max) {
                        case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                        case g: h = (b - r) / d + 2; break;
                        case b: h = (r - g) / d + 4; break;
                    }
                    h /= 6;
                }
                return [Math.round(h * 360), Math.round(s * 100), Math.round(l * 100)];
            }

            const hsl = hexToHsl(pick.hex);
            const accentHue = (hsl[0] + 40) % 360;
            const accentLightness = '58%';
            const accent = `hsl(${accentHue} 90% ${accentLightness})`;
            document.documentElement.style.setProperty('--terminal-accent', accent);
            document.documentElement.style.setProperty('--terminal-accent-bright', `hsl(${accentHue} 95% 65%)`);

            if (lum < 0.25) {
                document.documentElement.style.setProperty('--terminal-background', 'rgba(8,10,12,0.85)');
            } else {
                document.documentElement.style.setProperty('--terminal-background', 'rgba(12,14,18,0.9)');
            }
        })();
    </script>
</body>

</html>